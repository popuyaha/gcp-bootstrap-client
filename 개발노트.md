# Windows VM을 사용한 시작

- 시작을 위해 `cloud.google.com`으로 접속.  무료로 시작하기를 선택한다.

  ![image-20200304140416391](.\image\image-20200304140416391.png)

- ![image-20200304141916900](.\image\image-20200304141916900.png)

이어 주소정보, 카드정보 기입이 끝나면 평가판 사용이 완료된다.

- 만들 VM은 서버리스 컴퓨팅이 목적이므로 알맞게 선택한다.



AWS를 사용한 시스템이지만 GCP를 어떤 서비스를 선택해야 할지 몰라 많은 시간이 소비되었다.

그중 가장 유사한 서비스라 생각되는 부분부터 작업을 해보려 한다.

## App Engine에서 Firebase로 사용자 인증

#### 사용한 Tool

- Firebase 
- FirebaseUI
- NDB 클라이언트 라이브러리
- Cloud Firestore  - AWS의 DynamoDB의 역할을 해줄 NoSQL DB이다.
- Cloud Storage - AWS의 Amazon S3의 역할을 해줄 개체 저장소이다.

### Firebase 계정 생성

Firebase에 접속해 계정을 생성한다

![image-20200304170404273](.\image\image-20200304170404273.png)



GCP에서 생성했던 프로젝트를 선택한다.

![image-20200304170451489](.\image\image-20200304170451489.png)

- 요금제를 확인하고 선택한다.

  ![image-20200304170549880](.\image\image-20200304170549880.png)

- 2, 3단계를 확인 후 Firebase를 추가한다.

  ![image-20200304170656651](.\image\image-20200304170656651.png)

- 앱 만들기를 클릭한다

![image-20200304172114716](.\image\image-20200304172114716.png)

- 생성해서 나온 코드들을 복사해둔다

![image-20200305013602104](.\image\image-20200305013602104.png)

- 인증 항목의 로그인 방법 탭에서 로그인 제공업체를 세팅해준다

![image-20200305014323695](.\image\image-20200305014323695.png)

![image-20200305014345054](.\image\image-20200305014345054.png)

- npm 명령어로 firebase를 설치해준다

```powershell
npm install firebase
```

- firebase.js를 만들어 firebase의 세팅을 해준다

```javascript
import firebase from 'firebase'
import 'firebase/firestore'
const config = {
   apiKey: "xxxxxxxxxxxxxx",
   authDomain: "xxxxxxxxxxxxxx",
   databaseURL: "xxxxxxxxxxxxxx",
   projectId: "xxxxxxxxxxxxxxt",
   storageBucket: "xxxxxxxxxxxxxx",
   messagingSenderId: "xxxxxxxxxxxxxx"
};
const firestore = firebase.initializeApp(config);
const db = firebase.firestore();
export default db;
```

- main.js 부분에 추가해준다

```javascript
// /src/main.js
...
import firebase from 'firebase'
...
```





### Cloud Firestore 시작하기 

#### Cloud Firesotre 데이터베이스 만들기

 위 생성한 Firebase의 프로젝트의 Console 창에서 데이터베이스를 선택한 다음 Cloud FIresotre용 데이터베이스 만들기를 클릭한다.





### App Engine 시작하기 

Cloud Shell을 사용하여 앱을 배포한다.

![image-20200305093611756](.\image\image-20200305093611756.png)





### GCP용 Serverless 서비스 시작하기

#### 템플릿 생성하기

- 새로운 서비스를 템플릿을 사용하여 제작한다

```powershell
serverless create --template google-nodejs --path mlog-gcp-serverless
```

- 의존성 라이브러리들을 설치해준다

```powershell
cd mlog-gcp-serverless
npm install
```



#### API 활성화

Serverless가 GCP의 자원을 사용할 수 있도록 API를 사용 가능하게 만들어 주어야 한다

- API 대시보드로 이동해 생성한 프로젝트를 선택하고 다음 API를 활성화 시킨다

![image-20200305102128317](.\image\image-20200305102128317.png)

- Google Cloud Functions
- Google Cloud Deployment Manager
- Google Cloud Storage
- Stackdriver Logging



#### Google 자격증명

서버리스가 프로젝트에서 리소스를 생서하는데 사용할 수 있는 역할로 자격 증명을 생성해야 한다.

- Google Cloud Console로 이동해 작업중인 프로젝트를 선택
- IAM & 관리자를 클릭 후 서비스 계정을 누른뒤 서비스 계정 생성을 클릭

![image-20200305105605461](.\image\image-20200305105605461.png)



![image-20200305105748197](.\image\image-20200305105748197.png)

- 입력 서비스계정 이름과 서비스계정 ID 입력

![image-20200305110804631](.\image\image-20200305110804631.png)

- 아래 역할을 추가하고 계속 버튼 클릭

  ![image-20200305111221750](.\image\image-20200305111221750.png)

  - 배포 관리자 편집자
  - 저장소 관리자
  - 로그 기록 관리자
  - Cloud Functions 개발자

- 아래 키 생성 버튼을 클릭하고 JSON 키 유형을 클릭해서 파일을 다운로드 한다.

![image-20200305111348985](.\image\image-20200305111348985.png)

![image-20200305111412631](.\image\image-20200305111412631.png)

#### provider 설정 업데이트

이제 serverless.yml파일을 열고 provider Google Cloud Project ID와 keyfile.json 파일 경로로 섹션을 업데이트 한다.

```yaml
provider:
	name: google
	runtime: nodejs8
	project: mlog-gcp
	credentials: ~/.cloud/keyfile.json
```



### Cloud Function 설정하기 

AWS Lambda의 FaaS 역할을 해줄 서비스이다.

